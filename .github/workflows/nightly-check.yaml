name: Nightly CI

on:
  schedule:
    - cron: "0 3 * * *"

permissions:
  contents: read

jobs:
  nightly:
    name: Nightly HA Config Check
    runs-on: ubuntu-latest

    strategy:
      matrix:
        version: [ "stable", "beta" ]

    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v3

      - name: ğŸ”‘ Dummy secrets
        run: |
          cp .secrets_dummy.yaml secrets.yaml
          cp credentials/.google_dummy.json credentials/google.json

      - name: â¤µï¸ Fetch Home Assistant Docker Image
        run: |
          docker pull -q "ghcr.io/home-assistant/home-assistant:${{ matrix.version }}"

      - name: ğŸš€ Run Home Assistant Configuration Check
        run: |
          docker run --rm \
            -v .:/config \
            "ghcr.io/home-assistant/home-assistant:${{ matrix.version }}" \
            python -m homeassistant \
              --config "/config" \
              --script check_config
